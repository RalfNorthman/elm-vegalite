<!DOCTYPE html>
<html>
  <head>
    <title>Elm-Vegalite Data Tests</title>
    <meta charset="utf-8" />

    <!-- These scripts link to the Vega/Vega-Lite runtime -->
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

    <!-- Only necessary for Apache arrow file reading -->
    <script src="https://cdn.jsdelivr.net/npm/apache-arrow"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-loader-arrow"></script>

    <script src="js/dataTests.js"></script>

    <!-- Page formatting -->
    <link
      href="https://fonts.googleapis.com/css?family=Roboto:300"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Roboto", sans-serif;
      }
      figcaption {
        padding-top: 0.5em;
      }
      .cell {
        float: left;
        padding: 1em;
        border-radius: 1em;
        margin: 1.2em;
        background-color: rgb(251, 247, 238);
      }
    </style>
  </head>

  <body>
    <h1>Elm-Vega Data Tests</h1>

    <h2>Simple Data loading and generation</h2>
    <p>
      The following should all appear identical but were generated via different
      data functions.
    </p>

    <figure class="cell">
      <div id="data1"></div>
      <figcaption>Data from columns</figcaption>
    </figure>
    <figure class="cell">
      <div id="data2"></div>
      <figcaption>Data from rows</figcaption>
    </figure>
    <figure class="cell">
      <div id="data3"></div>
      <figcaption>Data from json</figcaption>
    </figure>
    <figure class="cell">
      <div id="data4"></div>
      <figcaption>Data from csv file</figcaption>
    </figure>
    <figure class="cell">
      <div id="data5"></div>
      <figcaption>Data from tsv file</figcaption>
    </figure>
    <figure class="cell">
      <div id="data6"></div>
      <figcaption>
        Data from csv file using custom dsv with comma delimeter
      </figcaption>
    </figure>
    <figure class="cell">
      <div id="data7"></div>
      <figcaption>Data from json file</figcaption>
    </figure>
    <figure class="cell">
      <div id="data8"></div>
      <figcaption>Data named inline data row source</figcaption>
    </figure>
    <figure class="cell">
      <div id="data9"></div>
      <figcaption>Data named inline data column source</figcaption>
    </figure>
    <figure class="cell">
      <div id="data10"></div>
      <figcaption>Data named inline json source</figcaption>
    </figure>
    <div style="clear: left;"></div>

    <figure class="cell">
      <div id="data11"></div>
      <figcaption>Data from arrow file</figcaption>
    </figure>

    <h2>Named datasets</h2>
    <figure class="cell">
      <div id="namedData1"></div>
      <figcaption>Named data inline source</figcaption>
    </figure>
    <figure class="cell">
      <div id="namedData2"></div>
      <figcaption>Named data url source</figcaption>
    </figure>
    <figure class="cell">
      <div id="namedData3"></div>
      <figcaption>Named data but with no data specified</figcaption>
    </figure>
    <div style="clear: left;"></div>

    <h2>Loaded geo Files</h2>

    <figure class="cell">
      <div id="geodata1"></div>
      <figcaption>
        Data from external topojson file. Should show London boroughs in
        multiple nominal colours with legend.
      </figcaption>
    </figure>
    <div style="clear: left;"></div>

    <h2>Programatically generated geoFiles</h2>

    <figure class="cell">
      <div id="geodata2"></div>
      <figcaption>
        Data from inline geo file. Should be two coloured regions with legend.
      </figcaption>
    </figure>
    <div style="clear: left;"></div>

    <h2>Data transforms</h2>

    <figure class="cell">
      <div id="flatten1"></div>
      <figcaption>Flattened data structures from arrays.</figcaption>
    </figure>
    <div style="clear: left;"></div>

    <figure class="cell">
      <div id="fold1"></div>
      <figcaption>Folded data structures into key,value pairs.</figcaption>
    </figure>
    <div style="clear: left;"></div>

    <figure class="cell">
      <div id="pivot1"></div>
      <figcaption>Pivoted key,value pairs back to unfolded fields.</figcaption>
    </figure>
    <div style="clear: left;"></div>

    <h2>Domain Specification</h2>

    <figure class="cell">
      <div id="domain1"></div>
      <figcaption>
        Data ranging from 95-105 with no domain specified.
      </figcaption>
    </figure>

    <figure class="cell">
      <div id="domain2"></div>
      <figcaption>
        As previous but with domain set to [90,100].
      </figcaption>
    </figure>

    <figure class="cell">
      <div id="domain3"></div>
      <figcaption>
        As previous but unioned with domain set to [90,100] (should show 90 to
        105).
      </figcaption>
    </figure>

    <div style="clear: left;"></div>

    <h2>Data imputation</h2>

    <figure class="cell">
      <div id="impute1"></div>
      <figcaption>
        Simple imputation as a transform adding missing values when a=3 and c=1
        by inserting b=0
      </figcaption>
    </figure>
    <div style="clear: left;"></div>

    <figure class="cell">
      <div id="impute2"></div>
      <figcaption>
        Simple imputation as a transform adding missing values when a=3 and c=1
        by inserting b= mean of non-missing b values when c=1.
      </figcaption>
    </figure>
    <div style="clear: left;"></div>

    <figure class="cell">
      <div id="impute3"></div>
      <figcaption>
        Simple imputation as a transform adding missing values when a=3 and c=1
        by inserting b= mean of previous two b values when c=1.
      </figcaption>
    </figure>
    <div style="clear: left;"></div>

    <figure class="cell">
      <div id="impute4"></div>
      <figcaption>
        Simple imputation as a channel adding missing values when a=3 and c=1 by
        inserting b=0
      </figcaption>
    </figure>
    <div style="clear: left;"></div>

    <figure class="cell">
      <div id="impute5"></div>
      <figcaption>
        Simple imputation as a channel adding missing values when a=3 and c=1 by
        inserting b= mean of non-missing b values when c=1.
      </figcaption>
    </figure>
    <div style="clear: left;"></div>

    <figure class="cell">
      <div id="impute6"></div>
      <figcaption>
        Simple imputation as a channel adding missing values when a=3 and c=1 by
        inserting b= mean of previous two b values when c=1.
      </figcaption>
    </figure>
    <div style="clear: left;"></div>

    <figure class="cell">
      <div id="impute7"></div>
      <figcaption>
        Simple imputation as a channel inserting b=100 when a is 4
      </figcaption>
    </figure>
    <div style="clear: left;"></div>

    <figure class="cell">
      <div id="impute8"></div>
      <figcaption>
        Simple imputation as a channel inserting b=100 when a is between 4 and
        less than 6
      </figcaption>
    </figure>
    <div style="clear: left;"></div>

    <h2>Data Sampling</h2>
    <figure class="cell">
      <div id="sample1"></div>
      <figcaption>Sample up to 200 points in right hand chart</figcaption>
    </figure>
    <div style="clear: left;"></div>

    <h2>Data Binning</h2>
    <figure class="cell">
      <div id="bin1"></div>
      <figcaption>Histogram based on pre-binned data</figcaption>
    </figure>

    <figure class="cell">
      <div id="bin2"></div>
      <figcaption>
        Default binning of Guassian distributed random numbers with mean of 10
        and stdev of 2.
      </figcaption>
    </figure>

    <figure class="cell">
      <div id="bin3"></div>
      <figcaption>As previous but anchoring on 0.5</figcaption>
    </figure>

    <div style="clear: left;"></div>

    <h2>Sequence Generators</h2>
    <figure class="cell">
      <div id="sequence1"></div>
      <figcaption>Sine curve sequence using default seq name</figcaption>
    </figure>
    <figure class="cell">
      <div id="sequence2"></div>
      <figcaption>Sine curve sequence using custom seq name</figcaption>
    </figure>
    <div style="clear: left;"></div>

    <h2>Filtering</h2>

    <figure class="cell">
      <div id="filter1"></div>
      <figcaption>
        Filter using a single filter expression so that only A C or E categories
        are selected.
      </figcaption>
    </figure>
    <div style="clear: left;"></div>

    <figure class="cell">
      <div id="filter2"></div>
      <figcaption>
        Filter using composed filter expressions so that only A C or E
        categories are selected (should appear identical to previous test).
      </figcaption>
    </figure>
    <div style="clear: left;"></div>

    <h2>Annotation</h2>

    <figure class="cell">
      <div id="annotate1"></div>
      <figcaption>
        Annotation layer with null data to prevent inheriting parent in layered
        spec.
      </figcaption>
    </figure>
    <div style="clear: left;"></div>

    <figure class="cell">
      <div id="datum1"></div>
      <figcaption>
        Use of datum literal to provide a dashed annotation line in data space
        at 200 on the y-axis.
      </figcaption>
    </figure>

    <figure class="cell">
      <div id="datum2"></div>
      <figcaption>
        and at 2016 on the x-axis.
      </figcaption>
    </figure>
    <div style="clear: left;"></div>

    <h2>Axis Replication/Shifting with Datum</h2>

    <figure class="cell">
      <div id="datum3"></div>
      <figcaption>
        Highlight origin-intersecting axes with datum and rule.
      </figcaption>
    </figure>
    <div style="clear: left;"></div>

    <figure class="cell">
      <div id="datum4"></div>
      <figcaption>
        Shift axes to data origin. This approach avoids the use of experimental
        signals in vega-lite, but is not entirely satisfactory as it relies on
        hard coding of domain extents.
      </figcaption>
    </figure>
    <div style="clear: left;"></div>

    <h2>Text Encoding Datum</h2>

    <figure class="cell">
      <div id="datum5"></div>
      <figcaption>
        Create text datum numeric constant so it can be encoded and formatted to
        2dp.
      </figcaption>
    </figure>

    <figure class="cell">
      <div id="datum6"></div>
      <figcaption>
        Create text datum boolean constant.
      </figcaption>
    </figure>

    <figure class="cell">
      <div id="datum7"></div>
      <figcaption>
        Create text datum string constant.
      </figcaption>
    </figure>

    <figure class="cell">
      <div id="datum8"></div>
      <figcaption>
        Create conditional text that depends on whether data values are odd or
        even.
      </figcaption>
    </figure>

    <div style="clear: left;"></div>

    <h2>Source</h2>
    <div id="elmContainer"></div>

    <script>
      Elm.DataTests.init({
        node: document.getElementById("elmContainer"),
      }).ports.elmToJS.subscribe(function (namedSpecs) {
        for (let name of Object.keys(namedSpecs)) {
          vegaEmbed(`#${name}`, namedSpecs[name], {
            actions: true,
            logLevel: vega.Warn,
          }).catch(console.warn);
        }
      });
    </script>
  </body>
</html>
